id: 0a8f5777-f38a-4c37-b531-411bdecef976
name: CVE-2020-1350 (SIGRED) exploitation pattern (ASIM DNS Solution)
description: |
  'This query detects the exploitation pattern of the CVE-2020-1350 (SIGRED) vulnerability. This query utilizes [ASIM](https://aka.ms/AboutASIM) normalization and is applied to any source that supports the ASIM DNS schema.'
tags:
  - Schema: ASimDns
    SchemaVersion: 0.1.6
requiredDataConnectors:
  - connectorId: ASimDnsActivityLogs
    dataTypes:
      - ASimDnsActivityLogs
  - connectorId: GCPDNSDataConnector
    dataTypes:
      - GCP_DNS_CL
  - connectorId: AzureFirewall
    dataTypes:
      - AzureDiagnostics
  - connectorId: CiscoUmbrellaDataConnector
    dataTypes:
      - Cisco_Umbrella_proxy_CL
  - connectorId: Corelight
    dataTypes:
      - Corelight_CL
  - connectorId: InfobloxNIOS
    dataTypes:
      - Syslog
  - connectorId: NXLogDnsLogs
    dataTypes:
      - NXLog_DNS_Server_CL
  - connectorId: DNS
    dataTypes:
      - DnsEvents
  - connectorId: AIVectraStream
    dataTypes:
      - VectraStream_CL
  - connectorId: WindowsForwardedEvents
    dataTypes:
      - WindowsEvents
  - connectorId: Zscaler
    dataTypes:
      - CommonSecurityLog
  - connectorId: ISCBind
    dataTypes:
      - Syslog
tactics:
  - CommandAndControl
relevantTechniques:
  - T1068
  - T1055
query: |
  let threshold = 15;
  _Im_Dns(starttime=ago(1d),endtime=now())
  | where DnsQueryTypeName in~ ('SIG', 'RRSIG')
  | where NetworkProtocol =~ 'TCP'
  | summarize Count=count() by SrcIpAddr, bin(TimeGenerated, 1m)
  | where Count > threshold
  | extend IP_0_Address = SrcIpAddr
entityMappings:
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SrcIpAddr